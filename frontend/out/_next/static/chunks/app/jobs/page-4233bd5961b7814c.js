(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{968:(e,t,a)=>{"use strict";a.d(t,{b:()=>n});var r=a(2115),s=a(3655),d=a(5155),o=r.forwardRef((e,t)=>(0,d.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null===(a=e.onMouseDown)||void 0===a||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));o.displayName="Label";var n=o},1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2714:(e,t,a)=>{"use strict";a.d(t,{J:()=>l});var r=a(5155),s=a(2115),d=a(968),o=a(2085),n=a(3999);let i=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(d.b,{ref:t,className:(0,n.cn)(i(),a),...s})});l.displayName=d.b.displayName},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>d,f:()=>n,z:()=>o});var r=a(2596),s=a(9688);function d(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}let o=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]};function n(e){let t=new Date,a=new Date(e),r=t.getTime()-a.getTime(),s=Math.floor(r/1e3),d=Math.floor(r/6e4),o=Math.floor(r/36e5),n=Math.floor(r/864e5);return s<60?"".concat(s," second").concat(1!==s?"s":""," ago"):d<60?"".concat(d," minute").concat(1!==d?"s":""," ago"):o<24?"".concat(o," hour").concat(1!==o?"s":""," ago"):"".concat(n," day").concat(1!==n?"s":""," ago")}},4616:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7168:(e,t,a)=>{"use strict";a.d(t,{$:()=>l,r:()=>i});var r=a(5155),s=a(2115),d=a(9708),o=a(2085),n=a(3999);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:a,variant:s,size:o,asChild:l=!1,...c}=e,u=l?d.DX:"button";return(0,r.jsx)(u,{className:(0,n.cn)(i({variant:s,size:o,className:a})),ref:t,...c})});l.displayName="Button"},7378:(e,t,a)=>{Promise.resolve().then(a.bind(a,9405))},7497:(e,t,a)=>{"use strict";a.d(t,{K:()=>i});var r=a(3999),s=a(9509);let d=["pending_code_review","job_run_failed"],o=["shared","approved","job_run_finished"],n=()=>s.env.NEXT_PUBLIC_API_URL||"",i={async getDatasets(){let e=await fetch("".concat(n(),"/api/v1/datasets")),t=await e.json(),a=await this.getJobs(),s=a.jobs.reduce((e,t)=>{let a=e.get(t.datasetName)||[];return e.set(t.datasetName,[...a,t]),e},new Map),d=a.jobs.reduce((e,t)=>{let a=e.get(t.datasetName)||new Set;return a.add(t.requesterEmail),e.set(t.datasetName,a),e},new Map),o=e=>Math.floor((new Date().getTime()-e.getTime())/6048e5),i=a.jobs.reduce((e,t)=>{let a=o(t.requestedTime);if(a>=0&&a<12){let r=e.get(t.datasetName)||Array(12).fill(0);r[11-a]++,e.set(t.datasetName,r)}return e},new Map);return{datasets:t.datasets.map(e=>{var t,a;return{uid:e.uid,name:e.name,description:e.summary,size:(0,r.z)(e.privateSize),type:e.private.split(".").pop()||"unknown",createdAt:new Date(e.createdAt),lastUpdated:new Date(e.updatedAt),accessRequests:0,permissions:[],usersCount:(null===(t=d.get(e.name))||void 0===t?void 0:t.size)||0,requestsCount:(null===(a=s.get(e.name))||void 0===a?void 0:a.length)||0,activityData:i.get(e.name)||Array(12).fill(0)}})}},async createDataset(e){try{let t=await fetch("".concat(n(),"/api/v1/datasets"),{method:"POST",body:e});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to create dataset")}return await t.json(),{success:!0,message:'Dataset "'.concat(e.get("name"),'" created successfully')}}catch(e){throw console.error("Error creating dataset:",e),e}},async getJobs(){let e=await fetch("".concat(n(),"/api/v1/jobs"));if(!e.ok)throw Error((await e.json()).detail||"Failed to fetch jobs");return{jobs:(await e.json()).jobs.map(e=>({uid:e.uid,datasetName:e.datasetName,projectName:e.name,description:e.description,requestedTime:new Date(e.createdAt),requesterEmail:e.createdBy,status:d.includes(e.status)?"pending":o.includes(e.status)?"approved":"denied"}))}},async getAutoApprovedDatasites(){let e=await fetch("".concat(n(),"/api/v1/auto-approved-datasites"));if(!e.ok)throw Error((await e.json()).detail||"Failed to fetch auto-approve list");return await e.json()},async setAutoApprovedDatasites(e){let t=await fetch("".concat(n(),"/api/v1/auto-approved-datasites"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.json()||"Failed to update auto-approve list");return await t.json()},async deleteDataset(e){let t=await fetch("".concat(n(),"/api/v1/datasets/").concat(encodeURIComponent(e)),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).detail||"Failed to delete dataset");return await t.json()},async downloadDatasetPrivate(e){let t=await fetch("".concat(n(),"/api/v1/datasets/").concat(e,"/private"),{method:"GET"});if(!t.ok)throw Error((await t.json()).detail||"Failed to download dataset");return t}}},7576:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},8145:(e,t,a)=>{"use strict";a.d(t,{E:()=>n});var r=a(5155);a(2115);var s=a(2085),d=a(3999);let o=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,d.cn)(o({variant:a}),t),...s})}},8482:(e,t,a)=>{"use strict";a.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>i,Zp:()=>o,aR:()=>n});var r=a(5155),s=a(2115),d=a(3999);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,d.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",a),...s})});n.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,d.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});i.displayName="CardTitle";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",a),...s})});l.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,d.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,d.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},9405:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C});var r=a(5155),s=a(2115),d=a(7168),o=a(8482),n=a(8145),i=a(9852),l=a(2714),c=a(9946);let u=(0,c.A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var m=a(1154),p=a(4616),h=a(4416),f=a(7576);let v=(0,c.A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),x=(0,c.A)("CodeXml",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);var g=a(7497),b=a(3999);let y=a(9509).env.NEXT_PUBLIC_API_URL||"";class j{async request(e,t){let a="".concat(y).concat(e),r={...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}},s=await fetch(a,r);if(!s.ok)throw console.debug(await s.text()),Error("API Error: ".concat(s.statusText));return s.json()}get(e){return this.request(e)}post(e,t){return this.request(e,{method:"POST",body:JSON.stringify(t)})}put(e,t){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}}let w=new j,N={openJobCode:e=>{let{jobUid:t}=e;return w.get("/api/v1/jobs/open-code/".concat(t))}};function k(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(!0),[x,y]=(0,s.useState)([]),[j,w]=(0,s.useState)(""),[N,k]=(0,s.useState)(!1);(0,s.useEffect)(()=>{C(),E()},[]);let C=async()=>{try{c(!0);let e=await g.K.getJobs();t(e.jobs)}catch(e){console.error("Failed to load jobs:",e)}finally{c(!1)}},E=async()=>{try{let{datasites:e}=await g.K.getAutoApprovedDatasites();y(e)}catch(e){console.error("Failed to load auto-approval list:",e)}},D=async()=>{if(!(!j||x.includes(j))){k(!0);try{let e=[...x,j];await g.K.setAutoApprovedDatasites(e),y(e),w("")}catch(e){console.error("Failed to update auto-approve list:",e)}finally{k(!1)}}},T=async e=>{k(!0);try{let t=x.filter(t=>t!==e);await g.K.setAutoApprovedDatasites(t),y(t)}catch(e){console.error("Failed to update auto-approve list:",e)}finally{k(!1)}},M=(a,r)=>{t(e.map(e=>e.uid===a?{...e,status:"approve"===r?"approved":"denied"}:e))},_=t=>e.filter(e=>e.status===t),R=e=>{switch(e){case"pending":return"border-yellow-200 bg-yellow-50 text-yellow-600 dark:border-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/30";case"approved":return"border-emerald-200 bg-emerald-50 text-emerald-600 dark:border-emerald-900 dark:bg-emerald-900/30 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/30";case"denied":return"border-red-200 bg-red-50 text-red-600 dark:border-red-900 dark:bg-red-900/30 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30"}};return a?(0,r.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)(o.Zp,{className:"animate-pulse",children:[(0,r.jsxs)(o.aR,{children:[(0,r.jsx)("div",{className:"h-4 bg-muted rounded w-1/3"}),(0,r.jsx)("div",{className:"h-3 bg-muted rounded w-2/3"})]}),(0,r.jsx)(o.Wu,{children:(0,r.jsx)("div",{className:"h-16 bg-muted rounded"})})]},t))}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Jobs"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage data access requests and research projects"})]}),(0,r.jsxs)(o.Zp,{children:[(0,r.jsxs)(o.aR,{children:[(0,r.jsxs)(o.ZB,{className:"flex items-center",children:[(0,r.jsx)(u,{className:"mr-2 h-5 w-5"}),"Auto-approval Settings"]}),(0,r.jsx)(o.BT,{children:"Automatically approve requests from trusted datasites"})]}),(0,r.jsxs)(o.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(l.J,{htmlFor:"datasite",children:"Add trusted datasite email"}),(0,r.jsx)(i.p,{id:"datasite",placeholder:"trusted@email.com",value:j,type:"email",autoComplete:"off",onChange:e=>w(e.target.value),onKeyPress:e=>"Enter"===e.key&&D(),disabled:N})]}),(0,r.jsx)(d.$,{onClick:D,className:"mt-6",disabled:N||!j,children:N?(0,r.jsx)(m.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(p.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,r.jsxs)(n.E,{variant:"secondary",className:"flex items-center gap-1",children:[e,(0,r.jsx)("button",{onClick:()=>T(e),className:"ml-1 hover:text-destructive",disabled:N,children:(0,r.jsx)(h.A,{className:"h-3 w-3"})})]},e))})]})]}),0===e.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,r.jsx)("div",{className:"mx-auto h-12 w-12 text-muted-foreground mb-4",children:(0,r.jsx)(f.A,{className:"h-12 w-12"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No jobs found"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6",children:"Jobs will appear here when researchers request access to your datasets"})]})}):["pending","approved","denied"].map(e=>{let t=_(e);return 0===t.length?null:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold capitalize",children:[e," Jobs"]}),(0,r.jsx)(n.E,{variant:"outline",children:t.length})]}),(0,r.jsx)("div",{className:"grid gap-4",children:t.map(e=>(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)(o.ZB,{className:"text-lg flex items-center gap-4",children:[e.projectName,(0,r.jsx)(A,{job:e})]}),(0,r.jsx)(o.BT,{children:e.description})]}),(0,r.jsx)(n.E,{className:R(e.status),children:e.status})]})}),(0,r.jsx)(o.Wu,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Requested ",(0,b.f)(e.requestedTime.toISOString())," ","by ",e.requesterEmail]})}),(0,r.jsx)("div",{className:"flex space-x-2",children:"pending"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>M(e.uid,"approve"),className:"border-emerald-500 text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700 dark:border-emerald-700 dark:text-emerald-400 dark:hover:bg-emerald-900/30",children:[(0,r.jsx)(v,{className:"mr-2 h-4 w-4"}),"Approve"]}),(0,r.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>M(e.uid,"deny"),className:"border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30",children:[(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Deny"]})]})})]})})]},e.uid))})]},e)})]})}function A(e){let{job:t}=e;return(0,r.jsxs)(d.$,{variant:"outline",className:"h-8",onClick:()=>N.openJobCode({jobUid:t.uid}),children:[(0,r.jsx)(x,{}),"View Code"]})}function C(){return(0,r.jsx)(k,{})}},9852:(e,t,a)=>{"use strict";a.d(t,{p:()=>o});var r=a(5155),s=a(2115),d=a(3999);let o=s.forwardRef((e,t)=>{let{className:a,type:s,...o}=e;return(0,r.jsx)("input",{type:s,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...o})});o.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[410,441,684,358],()=>t(7378)),_N_E=e.O()}]);