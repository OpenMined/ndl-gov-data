(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{261:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var r=a(5155),s=a(2115),o=a(7168),d=a(8482),i=a(8145),n=a(9852),l=a(2714),c=a(9946);let u=(0,c.A)("settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var p=a(1154),m=a(4616),h=a(4416),f=a(7576);let v=(0,c.A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),x=(0,c.A)("code-xml",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);var g=a(7497),b=a(3999);let j=a(9509).env.NEXT_PUBLIC_API_URL||"";class y{async request(e,t){let a="".concat(j).concat(e),r={...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}},s=await fetch(a,r);if(!s.ok)throw console.debug(await s.text()),Error("API Error: ".concat(s.statusText));return s.json()}get(e){return this.request(e)}post(e,t){return this.request(e,{method:"POST",body:JSON.stringify(t)})}put(e,t){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}}let w=new y,N={openJobCode:e=>{let{jobUid:t}=e;return w.get("/api/v1/jobs/open-code/".concat(t))}},k=0,A=new Map,T=e=>{if(A.has(e))return;let t=setTimeout(()=>{A.delete(e),_({type:"REMOVE_TOAST",toastId:e})},1e6);A.set(e,t)},E=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?T(a):e.toasts.forEach(e=>{T(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},S=[],D={toasts:[]};function _(e){D=E(D,e),S.forEach(e=>{e(D)})}function M(e){let{...t}=e,a=(k=(k+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>_({type:"DISMISS_TOAST",toastId:a});return _({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>_({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function C(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(!0),[x,j]=(0,s.useState)([]),[y,w]=(0,s.useState)(""),[N,k]=(0,s.useState)(!1),[A,T]=(0,s.useState)(new Set),{toast:E}=function(){let[e,t]=s.useState(D);return s.useEffect(()=>(S.push(t),()=>{let e=S.indexOf(t);e>-1&&S.splice(e,1)}),[e]),{...e,toast:M,dismiss:e=>_({type:"DISMISS_TOAST",toastId:e})}}();(0,s.useEffect)(()=>{C(),F()},[]);let C=async()=>{try{c(!0);let e=await g.K.getJobs();t(e.jobs)}catch(e){console.error("Failed to load jobs:",e)}finally{c(!1)}},F=async()=>{try{let{datasites:e}=await g.K.getAutoApprovedDatasites();j(e)}catch(e){console.error("Failed to load auto-approval list:",e)}},R=async()=>{if(!(!y||x.includes(y))){k(!0);try{let e=[...x,y];await g.K.setAutoApprovedDatasites(e),j(e),w("")}catch(e){console.error("Failed to update auto-approve list:",e)}finally{k(!1)}}},I=async e=>{k(!0);try{let t=x.filter(t=>t!==e);await g.K.setAutoApprovedDatasites(t),j(t)}catch(e){console.error("Failed to update auto-approve list:",e)}finally{k(!1)}},J=async(e,a)=>{T(t=>new Set(t).add(e));try{let r;r="approve"===a?await g.K.approveJob(e):await g.K.rejectJob(e),t(t=>t.map(t=>t.uid===e?{...t,status:"approve"===a?"approved":"denied"}:t)),E({title:"approve"===a?"Job Approved":"Job Rejected",description:r.message,variant:"default"})}catch(e){console.error("Failed to ".concat(a," job:"),e),E({title:"Error",description:e instanceof Error?e.message:"Failed to ".concat(a," job"),variant:"destructive"})}finally{T(t=>{let a=new Set(t);return a.delete(e),a})}},q=t=>e.filter(e=>e.status===t),P=e=>{switch(e){case"pending":return"border-yellow-200 bg-yellow-50 text-yellow-600 dark:border-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/30";case"approved":return"border-emerald-200 bg-emerald-50 text-emerald-600 dark:border-emerald-900 dark:bg-emerald-900/30 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/30";case"denied":return"border-red-200 bg-red-50 text-red-600 dark:border-red-900 dark:bg-red-900/30 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30"}};return a?(0,r.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)(d.Zp,{className:"animate-pulse",children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)("div",{className:"h-4 bg-muted rounded w-1/3"}),(0,r.jsx)("div",{className:"h-3 bg-muted rounded w-2/3"})]}),(0,r.jsx)(d.Wu,{children:(0,r.jsx)("div",{className:"h-16 bg-muted rounded"})})]},t))}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Jobs"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage data access requests and research projects"})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsxs)(d.ZB,{className:"flex items-center",children:[(0,r.jsx)(u,{className:"mr-2 h-5 w-5"}),"Auto-approval Settings"]}),(0,r.jsx)(d.BT,{children:"Automatically approve requests from trusted datasites"})]}),(0,r.jsxs)(d.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(l.J,{htmlFor:"datasite",children:"Add trusted datasite email"}),(0,r.jsx)(n.p,{id:"datasite",placeholder:"trusted@email.com",value:y,type:"email",autoComplete:"off",onChange:e=>w(e.target.value),onKeyPress:e=>"Enter"===e.key&&R(),disabled:N})]}),(0,r.jsx)(o.$,{onClick:R,className:"mt-6",disabled:N||!y,children:N?(0,r.jsx)(p.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(m.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,r.jsxs)(i.E,{variant:"secondary",className:"flex items-center gap-1",children:[e,(0,r.jsx)("button",{onClick:()=>I(e),className:"ml-1 hover:text-destructive",disabled:N,children:(0,r.jsx)(h.A,{className:"h-3 w-3"})})]},e))})]})]}),0===e.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,r.jsx)("div",{className:"mx-auto h-12 w-12 text-muted-foreground mb-4",children:(0,r.jsx)(f.A,{className:"h-12 w-12"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No jobs found"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6",children:"Jobs will appear here when researchers request access to your datasets"})]})}):["pending","approved","denied"].map(e=>{let t=q(e);return 0===t.length?null:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold capitalize",children:[e," Jobs"]}),(0,r.jsx)(i.E,{variant:"outline",children:t.length})]}),(0,r.jsx)("div",{className:"grid gap-4",children:t.map(e=>(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)(d.ZB,{className:"text-lg flex items-center gap-4",children:[e.projectName,(0,r.jsx)(O,{job:e})]}),(0,r.jsx)(d.BT,{children:e.description})]}),(0,r.jsx)(i.E,{className:P(e.status),children:e.status})]})}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Requested ",(0,b.f)(e.requestedTime.toISOString())," ","by ",e.requesterEmail]})}),(0,r.jsx)("div",{className:"flex space-x-2",children:"pending"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>J(e.uid,"approve"),disabled:A.has(e.uid),className:"border-emerald-500 text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700 dark:border-emerald-700 dark:text-emerald-400 dark:hover:bg-emerald-900/30",children:[A.has(e.uid)?(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(v,{className:"mr-2 h-4 w-4"}),"Approve"]}),(0,r.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>J(e.uid,"deny"),disabled:A.has(e.uid),className:"border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30",children:[A.has(e.uid)?(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Deny"]})]})})]})})]},e.uid))})]},e)})]})}function O(e){let{job:t}=e;return(0,r.jsxs)(o.$,{variant:"outline",className:"h-8",onClick:()=>N.openJobCode({jobUid:t.uid}),children:[(0,r.jsx)(x,{}),"View Code"]})}function F(){return(0,r.jsx)(C,{})}},968:(e,t,a)=>{"use strict";a.d(t,{b:()=>i});var r=a(2115),s=a(3655),o=a(5155),d=r.forwardRef((e,t)=>(0,o.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));d.displayName="Label";var i=d},1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2714:(e,t,a)=>{"use strict";a.d(t,{J:()=>l});var r=a(5155),s=a(2115),o=a(968),d=a(2085),i=a(3999);let n=(0,d.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.b,{ref:t,className:(0,i.cn)(n(),a),...s})});l.displayName=o.b.displayName},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o,f:()=>i,z:()=>d});var r=a(2596),s=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}let d=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]};function i(e){let t=new Date,a=new Date(e),r=t.getTime()-a.getTime(),s=Math.floor(r/1e3),o=Math.floor(r/6e4),d=Math.floor(r/36e5),i=Math.floor(r/864e5);return s<60?"".concat(s," second").concat(1!==s?"s":""," ago"):o<60?"".concat(o," minute").concat(1!==o?"s":""," ago"):d<24?"".concat(d," hour").concat(1!==d?"s":""," ago"):"".concat(i," day").concat(1!==i?"s":""," ago")}},4616:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7168:(e,t,a)=>{"use strict";a.d(t,{$:()=>l,r:()=>n});var r=a(5155),s=a(2115),o=a(9708),d=a(2085),i=a(3999);let n=(0,d.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:a,variant:s,size:d,asChild:l=!1,...c}=e,u=l?o.DX:"button";return(0,r.jsx)(u,{className:(0,i.cn)(n({variant:s,size:d,className:a})),ref:t,...c})});l.displayName="Button"},7378:(e,t,a)=>{Promise.resolve().then(a.bind(a,261))},7497:(e,t,a)=>{"use strict";a.d(t,{K:()=>n});var r=a(3999),s=a(9509);let o=["pending_code_review","job_run_failed"],d=["shared","approved","job_run_finished"],i=()=>s.env.NEXT_PUBLIC_API_URL||"",n={async getDatasets(){let e=await fetch("".concat(i(),"/api/v1/datasets")),t=await e.json(),a=await this.getJobs(),s=a.jobs.reduce((e,t)=>{let a=e.get(t.datasetName)||[];return e.set(t.datasetName,[...a,t]),e},new Map),o=a.jobs.reduce((e,t)=>{let a=e.get(t.datasetName)||new Set;return a.add(t.requesterEmail),e.set(t.datasetName,a),e},new Map),d=e=>Math.floor((new Date().getTime()-e.getTime())/6048e5),n=a.jobs.reduce((e,t)=>{let a=d(t.requestedTime);if(a>=0&&a<12){let r=e.get(t.datasetName)||Array(12).fill(0);r[11-a]++,e.set(t.datasetName,r)}return e},new Map);return{datasets:t.datasets.map(e=>{var t,a;return{uid:e.uid,name:e.name,description:e.summary,size:(0,r.z)(e.privateSize),type:e.private.split(".").pop()||"unknown",createdAt:new Date(e.createdAt),lastUpdated:new Date(e.updatedAt),accessRequests:0,permissions:[],usersCount:(null==(t=o.get(e.name))?void 0:t.size)||0,requestsCount:(null==(a=s.get(e.name))?void 0:a.length)||0,activityData:n.get(e.name)||Array(12).fill(0)}})}},async createDataset(e){try{let t=await fetch("".concat(i(),"/api/v1/datasets"),{method:"POST",body:e});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to create dataset")}return await t.json(),{success:!0,message:'Dataset "'.concat(e.get("name"),'" created successfully')}}catch(e){throw console.error("Error creating dataset:",e),e}},async getJobs(){let e=await fetch("".concat(i(),"/api/v1/jobs"));if(!e.ok)throw Error((await e.json()).detail||"Failed to fetch jobs");return{jobs:(await e.json()).jobs.map(e=>({uid:e.uid,datasetName:e.datasetName,projectName:e.name,description:e.description,requestedTime:new Date(e.createdAt),requesterEmail:e.createdBy,status:o.includes(e.status)?"pending":d.includes(e.status)?"approved":"denied"}))}},async getAutoApprovedDatasites(){let e=await fetch("".concat(i(),"/api/v1/auto-approved-datasites"));if(!e.ok)throw Error((await e.json()).detail||"Failed to fetch auto-approve list");return await e.json()},async setAutoApprovedDatasites(e){let t=await fetch("".concat(i(),"/api/v1/auto-approved-datasites"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.json()||"Failed to update auto-approve list");return await t.json()},async deleteDataset(e){let t=await fetch("".concat(i(),"/api/v1/datasets/").concat(encodeURIComponent(e)),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).detail||"Failed to delete dataset");return await t.json()},async downloadDatasetPrivate(e){let t=await fetch("".concat(i(),"/api/v1/datasets/").concat(e,"/private"),{method:"GET"});if(!t.ok)throw Error((await t.json()).detail||"Failed to download dataset");return t},async approveJob(e){let t=await fetch("".concat(i(),"/api/v1/jobs/").concat(e,"/approve"),{method:"POST"});if(!t.ok)throw Error((await t.json()).detail||"Failed to approve job");return await t.json()},async rejectJob(e){let t=await fetch("".concat(i(),"/api/v1/jobs/").concat(e,"/reject"),{method:"POST"});if(!t.ok)throw Error((await t.json()).detail||"Failed to reject job");return await t.json()}}},7576:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},8145:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var r=a(5155);a(2115);var s=a(2085),o=a(3999);let d=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,o.cn)(d({variant:a}),t),...s})}},8482:(e,t,a)=>{"use strict";a.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>n,Zp:()=>d,aR:()=>i});var r=a(5155),s=a(2115),o=a(3999);let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});d.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});n.displayName="CardTitle";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})});l.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},9852:(e,t,a)=>{"use strict";a.d(t,{p:()=>d});var r=a(5155),s=a(2115),o=a(3999);let d=s.forwardRef((e,t)=>{let{className:a,type:s,...d}=e;return(0,r.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...d})});d.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[410,441,684,358],()=>t(7378)),_N_E=e.O()}]);